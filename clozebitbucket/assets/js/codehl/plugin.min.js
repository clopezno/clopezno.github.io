tinymce.PluginManager.add("codehl",function(e,t){function n(){var n=e.selection.getContent({format:"text"});e.windowManager.open({title:"Format Code",url:t+"/dialog.html",width:780,height:600,inline:true,buttons:[{text:"Insert",onclick:function(){var t=e.windowManager.getWindows()[0];e.insertContent(t.getContentWindow().document.getElementById("codearea").innerHTML),t.close()}},{text:"Close",onclick:"close"}]},{code:n})}function r(){function i(e){subexp=new RegExp("[a-zA-Z0-9._?]+");expWeight=new RegExp("{[0-9.]*:");expType=new RegExp(":[A-Z._?]+:");expAnswers=new RegExp("%[^}]+");weight=e.match(expWeight);type=e.match(expType);list_answers=e.match(expAnswers);var t={weight:weight.toString().match(subexp),type:type.toString().match(subexp),answers:s(list_answers.toString())};return t}function s(e){var t=new Array;textValue="%[0-9.]+%";textAnswer="%[a-zA-Z.]+";textFeedback="#[a-zA-Z0-9.]*";subexp=new RegExp("[a-zA-Z0-9.]+");expValue=new RegExp(textValue,"g");expAnswer=new RegExp(textAnswer,"g");expFeedback=new RegExp(textFeedback,"g");list_values=e.match(expValue);list_answers=e.match(expAnswer);list_feedback=e.match(expFeedback);for(var n=0;n<list_values.length;n++){t[n]=new Array;t[n][0]=list_values[n].match(subexp);t[n][1]=list_answers[n].match(subexp);t[n][2]=list_feedback[n].match(subexp)===null?"":list_feedback[n].match(subexp)}return t}function o(e,t){switch(t.type.toString()){case"SHORTANSWER":case"SHORTANSWER_C":return'<input type="text" id="quest_'+e+'"><span id="span_'+e+'"></span>';case"MULTICHOICE":var n="";for(var r=0;r<t.answers.length;r++){n+="<option>"+t.answers[r][1]+"</option>"}return'<select id="quest_'+e+'">'+n+'</select><span id="span_'+e+'"></span>';case"MULTICHOICE_H":case"MULTICHOICE_V":var i="";for(var r=0;r<t.answers.length;r++){i+='<input type="radio" name="radio" id="quest_'+e+'" value="'+t.answers[r][1]+'">'+t.answers[r][1]}return i+'<span id="span_'+e+'"></span>'}}function u(e){var t="";for(var n=0;n<e.length;n++){var r=e.charCodeAt(n).toString(16).toUpperCase();while(r.length<4){r="0"+r}r="\\u"+r;t+=r}return t}function a(e,t){I+="I["+e+"] = new Array;";for(var n=0;n<t.length;n++){I+="I["+e+"]["+n+"] = new Array; I["+e+"]["+n+"][0] = "+t[n][0]+"; I["+e+"]["+n+'][1] = "'+u(t[n][1].toString())+'"; I['+e+"]["+n+'][2] = "'+u(t[n][2].toString())+'";'}}function f(){var e={meta:'<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">',title:"<title>Cloze Test</title>",css:"<style>.has-error{border-color:#A94442}.has-success{border-color:#3C763D}pre{display:block;padding:9.5px;margin:0 0 10px;font-size:13px;line-height:1.42857143;word-break:break-all;word-wrap:break-word;color:#333;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px}.container{max-width: 970px;margin-right:auto;margin-left:auto;padding-left:5px;padding-right:5px;}.pln{color:#000}@media screen{.str{color:#080}.kwd{color:#008}.com{color:#800}.typ{color:#606}.lit{color:#066}.clo,.opn,.pun{color:#660}.tag{color:#008}.atn{color:#606}.atv{color:#080}.dec,.var{color:#606}.fun{color:red}}@media print,projection{.str{color:#060}.kwd{color:#006;font-weight:700}.com{color:#600;font-style:italic}.typ{color:#404;font-weight:700}.lit{color:#044}.clo,.opn,.pun{color:#440}.tag{color:#006;font-weight:700}.atn{color:#404}.atv{color:#060}}pre.prettyprint{padding:2px;border:1px solid #888}ol.linenums{margin-top:0;margin-bottom:0}li.L0,li.L1,li.L2,li.L3,li.L5,li.L6,li.L7,li.L8{list-style-type:none}li.L1,li.L3,li.L5,li.L7,li.L9{background:#eee}</style>",script:"<script>"+I+'function checkAnswers(){var e=0;var t=0;while((a=document.getElementById("quest_"+e+""))!==null){for(var n=0;n<I[e].length;n++){if(I[e][n][0]===100&&a.value===I[e][n][1]){isCorrect(e,I[e][n][2]);t+=I[e][n][0];break}else if(a.value===I[e][n][1]){isWrong(e,I[e][n][2]);break}if(n===I[e].length-1)isWrong(e,"Incorrecto")}e++}alert("Tu resultado final: "+t+" puntos.")}function isCorrect(e,t){var n=document.getElementById("quest_"+e+"").className="has-success";var r=document.getElementById("span_"+e+"").innerHTML=t}function isWrong(e,t){document.getElementById("quest_"+e+"").className="has-error";var n=document.getElementById("span_"+e+"").innerHTML=t}</script>'};return"<!DOCTYPE html><html><head>"+e.meta+e.title+e.css+e.script+"</head>"}function l(e){return'<body><div class="container">'+e+'</div><div class="container"><button id="check" onclick="checkAnswers();">Check!</button></div></body></html>'}var t=e.getContent({format:"raw"});question="{[0-9.]*:[A-Z._?]+:[^}]*}";find=new RegExp(question,"g");list=t.match(find);I="I = new Array;";if(list===null){alert("CLOZE question not found");return}for(var n=0;n<list.length;n++){elements=i(list[n]);t=t.replace(list[n],o(n,elements));a(n,elements.answers)}var r=window.open("");r.document.write(f()+l(t))}e.addButton("codehl",{title:"Format Code",image:t+"/img/codehl.gif",onclick:n}),e.addMenuItem("codehl",{text:"Format Code",image:t+"/img/codehl.gif",context:"tools",onclick:n}),e.addButton("clozeexport",{title:"Export CLOZE questions",image:t+"/img/codehle.gif",onclick:r},e.addMenuItem("clozeexport",{text:"Export CLOZE questions",image:t+"/img/codehle.gif",context:"tools",onclick:r}))})